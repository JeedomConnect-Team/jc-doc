"use strict";(self.webpackChunkjc_doc=self.webpackChunkjc_doc||[]).push([[7387],{6090:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>a,frontMatter:()=>t,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"tutorials/connection","title":"Connexion HTTP/Websocket","description":"Quelle est la diff\xe9rence entre connexion HTTP, Websocket et Polling ?","source":"@site/docs/tutorials/connection.md","sourceDirName":"tutorials","slug":"/tutorials/connection","permalink":"/jc-doc/docs/tutorials/connection","draft":false,"unlisted":false,"editUrl":"https://github.com/jeedomconnect-team/jc-doc/edit/main/docs/tutorials/connection.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"connection","title":"Connexion HTTP/Websocket","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Introduction","permalink":"/jc-doc/docs/tutorials/"},"next":{"title":"Copie des param\xe9trages","permalink":"/jc-doc/docs/tutorials/recopie"}}');var s=i(4848),r=i(8453);const t={id:"connection",title:"Connexion HTTP/Websocket",sidebar_position:2},l=void 0,c={},d=[{value:"Quelle est la diff\xe9rence entre connexion HTTP, Websocket et Polling ?",id:"quelle-est-la-diff\xe9rence-entre-connexion-http-websocket-et-polling-",level:2},{value:"Quelles modifications sont \xe0 faire pour obtenir une connexion en Websocket ?",id:"quelles-modifications-sont-\xe0-faire-pour-obtenir-une-connexion-en-websocket-",level:2},{value:"Pr\xe9-requis",id:"pr\xe9-requis",level:3},{value:"Etape 1 - Cr\xe9er un nom de domaine",id:"etape-1---cr\xe9er-un-nom-de-domaine",level:3},{value:"Etape 2 - Cr\xe9er une redirection de port",id:"etape-2---cr\xe9er-une-redirection-de-port",level:3},{value:"Etape 3 - Configuration sur le plugin JC",id:"etape-3---configuration-sur-le-plugin-jc",level:3},{value:"Etape 4 - Configuration de l&#39;\xe9quipement JC",id:"etape-4---configuration-de-l\xe9quipement-jc",level:3}];function u(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"quelle-est-la-diff\xe9rence-entre-connexion-http-websocket-et-polling-",children:"Quelle est la diff\xe9rence entre connexion HTTP, Websocket et Polling ?"}),"\n",(0,s.jsx)(n.p,{children:"Avec Jeedom Connect, il est possible d'\xe9tablir la connexion entre votre appareil et le plugin de trois fa\xe7ons diff\xe9rentes :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Http"})," : Au lancement de l'application, une connexion Http de type Source Event Server est \xe9tablie avec le plugin. Cette connexion est persistente mais uni-directionnelle : de Jeedom ",(0,s.jsx)(n.strong,{children:"vers"})," votre appareil. Les actions de votre appareil vers Jeedom sont des requ\xeates Http uniques utilisant le protocole JSON RPC.\nCe mode de connexion ne nec\xe9ssite aucune configuration particuli\xe8re."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Polling"})," : Lorsque les \xe9tats ont du mal \xe0 \xeatre rafraichi, vous pouvez utiliser cette option. Ici c'est l'application qui lance une connexion vers le plugin pour forcer la r\xe9cup\xe9ration des informations de fa\xe7on r\xe9guli\xe8re. Cette option est plus que conseill\xe9e lorsque vous utilisez les DNS Jeedom (incompatible avec ",(0,s.jsx)(n.code,{children:"websocket"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Websocket"})," : La connexion websocket est quant \xe0 elle bi-directionnelle. Elle n\xe9cessite n\xe9anmoins une configuration de votre r\xe9seau pour \xeatre utilis\xe9e en dehors de votre r\xe9seau local. Il est possible de faire une redirection de port sur votre routeur (m\xe9thode simple) ou bien de configurer votre serveur proxy ou le serveur Apache de votre Jeedom (utilisateurs avanc\xe9s, incompatible avec ",(0,s.jsx)(n.code,{children:"polling"}),")."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Le Websocket offre une connexion ",(0,s.jsx)(n.strong,{children:"plus stable et plus performante"})," que la connexion Http."]}),"\n",(0,s.jsx)(n.h2,{id:"quelles-modifications-sont-\xe0-faire-pour-obtenir-une-connexion-en-websocket-",children:"Quelles modifications sont \xe0 faire pour obtenir une connexion en Websocket ?"}),"\n",(0,s.jsx)(n.h3,{id:"pr\xe9-requis",children:"Pr\xe9-requis"}),"\n",(0,s.jsx)(n.p,{children:"Ce qu\u2019il va nous falloir pour l\u2019utilisation du websocket :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"avoir un nom de domaine qui est redirig\xe9 vers son IP publique"}),"\n",(0,s.jsx)(n.li,{children:"ouvrir un port sur sa box pour que la communication soit faite avec jeedom"}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsx)(n.p,{children:"Je vous laisse vous renseigner sur le net pour connaitre les risques d\u2019avoir un port ouvert depuis l\u2019ext\xe9rieur"})}),"\n",(0,s.jsx)(n.h3,{id:"etape-1---cr\xe9er-un-nom-de-domaine",children:"Etape 1 - Cr\xe9er un nom de domaine"}),"\n",(0,s.jsx)(n.p,{children:"Il existe tout un tas de fa\xe7on d'avoir un nom de domaine."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'Soit simplement en acheter un ultra personnalisable en ".fr", ".com" ou pleins d\'autres choses (pour quelques euros par an)'}),"\n",(0,s.jsxs)(n.li,{children:["Soit utiliser des services gratuits qui existent sur le net ","\u27a1\ufe0f"," c'est celui que je vais utiliser ici."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Je vais utiliser les services de ",(0,s.jsx)(n.a,{href:"https://my.noip.com/",children:"No IP"})]}),"\n",(0,s.jsx)(n.p,{children:"une fois que vous avez cr\xe9\xe9 un compte, cliquez sur"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"no-ip hostnames"}),"\n",(0,s.jsx)(n.li,{children:"create hostname"}),"\n",(0,s.jsxs)(n.li,{children:["remplissez les informations demand\xe9es \xe0 l'\xe9cran :","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["hostname : le nom que vous allez utilisez ","\u27a1\ufe0f"," ici j'ai choisi ",(0,s.jsx)(n.code,{children:"websocketJC"})]}),"\n",(0,s.jsxs)(n.li,{children:["domain : ce qui va \xeatre utilis\xe9 comme adresse, il y a plusieurs choix possibles. certains gratuits, d'autres non ! ","\u27a1\ufe0f"," ici je garde le choix par d\xe9faut ",(0,s.jsx)(n.code,{children:"ddns.net"})]}),"\n",(0,s.jsxs)(n.li,{children:["record type : on le laisse sur ",(0,s.jsx)(n.code,{children:"DNS Host (A)"})]}),"\n",(0,s.jsx)(n.li,{children:"IPv4 Address : elle est normalement d\xe9j\xe0 pr\xe9-rempli avec votre IP Public. (\xe0 v\xe9rifier et modifier si n\xe9cessaire)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Validez.\nA partir de maintenant, vous avez une adresse internet ",(0,s.jsx)(n.code,{children:"websocketJC.ddns.net"})," qui est redirig\xe9e vers votre adresse IP."]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Le nom de domaine que vous venez de cr\xe9er est disponible gratuitement pendant 30 jours seulement.",(0,s.jsx)(n.br,{}),"\n",'Sans action de votre part apr\xe8s ce d\xe9lai, il est supprim\xe9 ; pensez \xe0 cliquer sur le bouton "renouveller" 1 fois par mois (directement sur leur site)']})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"etape-2---cr\xe9er-une-redirection-de-port",children:"Etape 2 - Cr\xe9er une redirection de port"}),"\n",(0,s.jsxs)(n.p,{children:["La redirection de port va permettre \xe0 votre routeur de savoir g\xe9rer les informations qui lui arrivent.",(0,s.jsx)(n.br,{}),"\n","En gros : lorsque je re\xe7ois une demande sur le port X il faut renvoyer cette demande sur la machine Y et sur le port Z."]}),"\n",(0,s.jsx)(n.p,{children:"Ici ce qu'on va vouloir faire c'est lui dire :"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"lorsque tu re\xe7ois une demande sur le port X, renvoie cette demande sur mon jeedom sur le port 8090."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["Le port ",(0,s.jsx)(n.code,{children:"8090"})," est le port configur\xe9 par d\xe9faut pour JeedomConnect. Si jamais ce port est d\xe9j\xe0 utilis\xe9 sur votre installation vous pouvez en choisir un autre ","\u27a1\ufe0f"," pensez \xe0 le modifier dans l'\xe9cran de configuration du plugin."]})}),"\n",(0,s.jsx)(n.p,{children:"Connectez vous \xe0 l'interface administrateur de votre box/routeur et indiquez la redirection \xe0 faire."}),"\n",(0,s.jsx)(n.p,{children:"Sur une freebox : (mais les infos sont sensiblement pareil sur toutes les box)"}),"\n",(0,s.jsx)("img",{src:"../../img/tutorials/websocket_1.png",width:"50%"}),"\n",(0,s.jsx)(n.p,{children:"J'indique :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["IP de destination : ",(0,s.jsx)(n.code,{children:"192.168.0.14"}),"  ","\u27a1\ufe0f"," l\xe0 o\xf9 il y a mon jeedom ! (\xe0 personnaliser donc :) )"]}),"\n",(0,s.jsxs)(n.li,{children:["Protocole : ",(0,s.jsx)(n.code,{children:"TCP"})]}),"\n",(0,s.jsxs)(n.li,{children:["Port de d\xe9but et port de fin : ",(0,s.jsx)(n.code,{children:"12365"}),"  ","\u27a1\ufe0f",' \xe0 vous de d\xe9finir le num\xe9ro de port "exotique" que vous souhaitez utiliser']}),"\n",(0,s.jsxs)(n.li,{children:["Port de destination : ",(0,s.jsx)(n.code,{children:"8090"})," ","\u27a1\ufe0f"," c'est le port websocket utilis\xe9 par JeedomConnect"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Sauvegarder.",(0,s.jsx)(n.br,{}),"\n","A partir de maintenant, chaque demande re\xe7ue sur le port ",(0,s.jsx)(n.code,{children:"12365"})," de ma box sera automatiquement transf\xe9r\xe9e vers le port ",(0,s.jsx)(n.code,{children:"8090"})," sur l'ip ",(0,s.jsx)(n.code,{children:"192.168.0.14"})," de mon r\xe9seau."]}),"\n",(0,s.jsx)(n.h3,{id:"etape-3---configuration-sur-le-plugin-jc",children:"Etape 3 - Configuration sur le plugin JC"}),"\n",(0,s.jsx)(n.p,{children:"La prochaine \xe9tape consiste \xe0 donner l'ensemble des ces informations \xe0 JeedomConnect, de fa\xe7on \xe0 ce que les connexions puissent correctement avoir lieu."}),"\n",(0,s.jsxs)(n.p,{children:["Rendez vous sur la page ",(0,s.jsx)(n.code,{children:"Configuration"})," du plugin :"]}),"\n",(0,s.jsx)("img",{src:"../../img/tutorials/websocket_2.png"}),"\n",(0,s.jsxs)(n.p,{children:["Renseignez le champ ",(0,s.jsx)(n.code,{children:"Adresse externe websocket"})," avec les informations du nom de domaine que vous avez pr\xe9c\xe9demment cr\xe9\xe9 ainsi que le num\xe9ro de port que vous avez choisi ","\u27a1\ufe0f"," dans cet exemple \xe7a nous donne : ",(0,s.jsx)(n.code,{children:"ws://websocketJC.ddns.net:12365"})]}),"\n",(0,s.jsxs)(n.p,{children:["Vous pouvez \xe9galement renseignez le champs ",(0,s.jsx)(n.code,{children:"Adresse interne websocket"})," avec vos informations locales (et donc sans la redirection de port cette fois) ","\u27a1\ufe0f"," pour moi ca sera ",(0,s.jsx)(n.code,{children:"ws://192.168.0.14:8090"})]}),"\n",(0,s.jsxs)(n.p,{children:["Pensez \xe9galement \xe0 v\xe9rifier que le ",(0,s.jsx)(n.code,{children:"Port d'\xe9coute du websocket"})," est bien le m\xeame que celui que vous avez indiqu\xe9 lors de la cr\xe9ation de la redirection du votre box ","\u27a1\ufe0f"," par d\xe9faut le ",(0,s.jsx)(n.code,{children:"8090"})]}),"\n",(0,s.jsxs)(n.p,{children:["Cliquez sur le bouton ",(0,s.jsx)(n.code,{children:"Sauvegarder"}),"\nAssurez vous que le d\xe9mon est bien ",(0,s.jsx)(n.code,{children:"OK"})]}),"\n",(0,s.jsx)("img",{src:"../../img/tutorials/websocket_3.png",width:"70%"}),"\n",(0,s.jsx)(n.h3,{id:"etape-4---configuration-de-l\xe9quipement-jc",children:"Etape 4 - Configuration de l'\xe9quipement JC"}),"\n",(0,s.jsx)(n.p,{children:"Le plus gros de la configuration vient d'\xeatre r\xe9alis\xe9e.\nIl faut maintenant d\xe9finir si un \xe9quipement JC doit utiliser le websocket ou pas."}),"\n",(0,s.jsx)("img",{src:"../../img/tutorials/websocket_4.png",width:"40%"}),"\n",(0,s.jsxs)(n.p,{children:["Pour cela, s\xe9lectionnez un de vos \xe9quipement cr\xe9\xe9 sous JC, et cochez la case ",(0,s.jsx)(n.code,{children:"Activer la connexion par Websocket"}),", puis Sauvegarder."]}),"\n",(0,s.jsxs)(n.p,{children:["Si vous utilisez la connexion par QR Code, alors il faut en cr\xe9er un nouveau  ","\u27a1\ufe0f"," clic sur ",(0,s.jsx)(n.code,{children:"Reg\xe9n\xe9rer le QR Code"}),", puis ",(0,s.jsx)(n.code,{children:"Sauvegarder"})," \xe0 nouveau."]}),"\n",(0,s.jsx)(n.p,{children:"Vous pouvez maintenant aller sur votre t\xe9l\xe9phone et scannez le qr code.\nUne fois connect\xe9e, vous devriez retrouver vos informations de connexion dans le menu de l'application :"}),"\n",(0,s.jsx)("img",{src:"../../img/tutorials/websocket_5.png",width:"40%"}),"\n",(0,s.jsx)(n.p,{children:"ou si vous \xeates connect\xe9s en wifi, vos informations locales :"}),"\n",(0,s.jsx)("img",{src:"../../img/tutorials/websocket_6.png",width:"40%"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["Vous avez donc maintenant des remont\xe9es d'informations et mise \xe0 jour de vos commandes beaucoup plus rapidement !",(0,s.jsx)(n.br,{}),"\n","Il ne vous reste plus qu'\xe0 profiter de votre nouvelle configuration ! \ud83d\ude01"]})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>l});var o=i(6540);const s={},r=o.createContext(s);function t(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);